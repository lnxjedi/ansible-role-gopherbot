[Unit]
Description=Gopherbot DevOps Chatbot
Documentation=https://godoc.org/github.com/lnxjedi/gopherbot
After=syslog.target
After=network.target

[Service]
Type=simple
User={{ gopherbot_user }}
Group={{ gopherbot_group }}
WorkingDirectory={{ gopherbot_install_directory }}
ExecStart={{ gopherbot_install_directory }}/gopherbot -plainlog {{ gopherbot_extra_args }}
Restart=on-failure
Environment=USER={{ gopherbot_user }} HOME={{ gopherbot_home }} HOSTNAME=%H
Environment=GOPHER_BRAIN_DIRECTORY={{ gopherbot_brain_directory }}
Environment=GOPHER_HISTORY_DIRECTORY={{ gopherbot_history_directory }}
Environment=GOPHER_WORKSPACE_DIRECTORY={{ gopherbot_workspace_directory }}
{% if gopherbot_config_repository is defined %}
Environment=GOPHER_CUSTOM_REPOSITORY={{ gopherbot_config_repository }}
{% endif %}
{% for envvar in gopherbot_environment %}
Environment={{ envvar }}
{% endfor %}

KillMode=process
# Give the robot plenty of time to finish plugins currently executing;
# no new plugins will start after SIGTERM is caught.
TimeoutStopSec=600

[Install]
WantedBy=multi-user.target
